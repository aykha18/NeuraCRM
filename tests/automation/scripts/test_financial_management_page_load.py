#!/usr/bin/env python3
"""
Financial Management Page Load Test
Tests the basic loading and display of the financial management page
"""

from playwright.sync_api import sync_playwright
import time

def test_financial_management_page_load():
    """Test that the financial management page loads correctly"""
    
    print("üí∞ Testing Financial Management Page Load")
    print("=" * 50)
    
    with sync_playwright() as p:
        browser = p.chromium.launch(headless=False, slow_mo=1000)
        context = browser.new_context(viewport={"width": 1920, "height": 1080})
        page = context.new_page()
        
        try:
            # Login
            print("üîê Logging in...")
            page.goto("http://127.0.0.1:8000/signin")
            page.wait_for_load_state("networkidle")
            
            page.fill('input[type="email"]', "nodeit@node.com")
            page.fill('input[type="password"]', "NodeIT2024!")
            page.click('button[type="submit"]')
            page.wait_for_url("**/dashboard", timeout=10000)
            print("‚úÖ Login successful")
            
            # Navigate to financial management
            print("\nüí∞ Navigating to Financial Management page...")
            page.goto("http://127.0.0.1:8000/financial-management")
            page.wait_for_load_state("networkidle")
            time.sleep(3)  # Wait for data to load
            print("‚úÖ Navigated to financial management page")
            
            # Check page title
            print("\nüìã Checking page title...")
            title = page.locator('h1:has-text("Financial Management")')
            if title.is_visible():
                print("‚úÖ Page title 'Financial Management' found")
            else:
                print("‚ùå Page title not found")
                return False
            
            # Check tabs
            print("\nüìë Checking tabs...")
            tabs = page.locator('nav.-mb-px.flex.space-x-8')
            if tabs.is_visible():
                print("‚úÖ Tabs container found")
                
                # Check individual tabs
                dashboard_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Dashboard")').first
                if dashboard_tab.is_visible():
                    print("  ‚úÖ Dashboard tab found")
                else:
                    print("  ‚ùå Dashboard tab not found")
                
                invoices_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Invoices")').first
                if invoices_tab.is_visible():
                    print("  ‚úÖ Invoices tab found")
                else:
                    print("  ‚ùå Invoices tab not found")
                
                payments_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Payments")').first
                if payments_tab.is_visible():
                    print("  ‚úÖ Payments tab found")
                else:
                    print("  ‚ùå Payments tab not found")
                
                revenue_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Revenue")').first
                if revenue_tab.is_visible():
                    print("  ‚úÖ Revenue tab found")
                else:
                    print("  ‚ùå Revenue tab not found")
                
                reports_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Reports")').first
                if reports_tab.is_visible():
                    print("  ‚úÖ Reports tab found")
                else:
                    print("  ‚ùå Reports tab not found")
                
                settings_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Settings")').first
                if settings_tab.is_visible():
                    print("  ‚úÖ Settings tab found")
                else:
                    print("  ‚ùå Settings tab not found")
            else:
                print("‚ùå Tabs container not found")
            
            # Check default tab (Dashboard)
            print("\nüìä Checking default tab content...")
            dashboard_content = page.locator('h2:has-text("Financial Dashboard")')
            if dashboard_content.is_visible():
                print("‚úÖ Dashboard tab is active by default")
                
                # Check for key metrics
                revenue_metrics = page.locator('.text-2xl.font-bold.text-green-600')
                if revenue_metrics.is_visible():
                    print("  ‚úÖ Revenue metrics found")
                else:
                    print("  ‚ùå Revenue metrics not found")
                
                invoice_metrics = page.locator('.text-2xl.font-bold.text-blue-600')
                if invoice_metrics.is_visible():
                    print("  ‚úÖ Invoice metrics found")
                else:
                    print("  ‚ùå Invoice metrics not found")
                
                payment_metrics = page.locator('.text-2xl.font-bold.text-purple-600')
                if payment_metrics.is_visible():
                    print("  ‚úÖ Payment metrics found")
                else:
                    print("  ‚ùå Payment metrics not found")
            else:
                print("‚ùå Dashboard tab content not found")
            
            # Test tab navigation
            print("\nüîÑ Testing tab navigation...")
            try:
                invoices_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Invoices")').first
                if invoices_tab.is_visible():
                    invoices_tab.click()
                    time.sleep(2)
                    print("‚úÖ Clicked on Invoices tab")
                    
                    # Check if invoices content is displayed
                    invoices_content = page.locator('h2:has-text("Invoice Management")')
                    if invoices_content.is_visible():
                        print("‚úÖ Invoices tab content is displayed")
                        
                        # Check for Create Invoice button
                        create_invoice_button = page.locator('button:has-text("Create Invoice")')
                        if create_invoice_button.is_visible():
                            print("  ‚úÖ Create Invoice button found")
                        else:
                            print("  ‚ùå Create Invoice button not found")
                    else:
                        print("‚ö†Ô∏è Invoices tab content not displayed (may be empty)")
                    
                    # Go back to dashboard tab
                    dashboard_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Dashboard")').first
                    if dashboard_tab.is_visible():
                        dashboard_tab.click()
                        time.sleep(2)
                        print("‚úÖ Returned to Dashboard tab")
                    else:
                        print("‚ö†Ô∏è Could not return to Dashboard tab")
                else:
                    print("‚ùå Invoices tab not found")
            except Exception as e:
                print(f"‚ö†Ô∏è Tab navigation test failed: {e}")
                print("‚úÖ Continuing with other tests...")
            
            # Test Payments tab
            print("\nüí≥ Testing Payments tab...")
            try:
                payments_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Payments")').first
                if payments_tab.is_visible():
                    payments_tab.click()
                    time.sleep(2)
                    print("‚úÖ Clicked on Payments tab")
                    
                    # Check if payments content is displayed
                    payments_content = page.locator('h2:has-text("Payment Management")')
                    if payments_content.is_visible():
                        print("‚úÖ Payments tab content is displayed")
                    else:
                        print("‚ö†Ô∏è Payments tab content not displayed (may be empty)")
                    
                    # Go back to dashboard tab
                    dashboard_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Dashboard")').first
                    if dashboard_tab.is_visible():
                        dashboard_tab.click()
                        time.sleep(2)
                        print("‚úÖ Returned to Dashboard tab")
                    else:
                        print("‚ö†Ô∏è Could not return to Dashboard tab")
                else:
                    print("‚ùå Payments tab not found")
            except Exception as e:
                print(f"‚ö†Ô∏è Payments tab test failed: {e}")
                print("‚úÖ Continuing with other tests...")
            
            # Test Revenue tab
            print("\nüìà Testing Revenue tab...")
            try:
                revenue_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Revenue")').first
                if revenue_tab.is_visible():
                    revenue_tab.click()
                    time.sleep(2)
                    print("‚úÖ Clicked on Revenue tab")
                    
                    # Check if revenue content is displayed
                    revenue_content = page.locator('h2:has-text("Revenue Recognition")')
                    if revenue_content.is_visible():
                        print("‚úÖ Revenue tab content is displayed")
                    else:
                        print("‚ö†Ô∏è Revenue tab content not displayed (may be empty)")
                    
                    # Go back to dashboard tab
                    dashboard_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Dashboard")').first
                    if dashboard_tab.is_visible():
                        dashboard_tab.click()
                        time.sleep(2)
                        print("‚úÖ Returned to Dashboard tab")
                    else:
                        print("‚ö†Ô∏è Could not return to Dashboard tab")
                else:
                    print("‚ùå Revenue tab not found")
            except Exception as e:
                print(f"‚ö†Ô∏è Revenue tab test failed: {e}")
                print("‚úÖ Continuing with other tests...")
            
            # Test Reports tab
            print("\nüìä Testing Reports tab...")
            try:
                reports_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Reports")').first
                if reports_tab.is_visible():
                    reports_tab.click()
                    time.sleep(2)
                    print("‚úÖ Clicked on Reports tab")
                    
                    # Check if reports content is displayed
                    reports_content = page.locator('h2:has-text("Financial Reports")')
                    if reports_content.is_visible():
                        print("‚úÖ Reports tab content is displayed")
                    else:
                        print("‚ö†Ô∏è Reports tab content not displayed (may be empty)")
                    
                    # Go back to dashboard tab
                    dashboard_tab = page.locator('nav.-mb-px.flex.space-x-8 button:has-text("Dashboard")').first
                    if dashboard_tab.is_visible():
                        dashboard_tab.click()
                        time.sleep(2)
                        print("‚úÖ Returned to Dashboard tab")
                    else:
                        print("‚ö†Ô∏è Could not return to Dashboard tab")
                else:
                    print("‚ùå Reports tab not found")
            except Exception as e:
                print(f"‚ö†Ô∏è Reports tab test failed: {e}")
                print("‚úÖ Continuing with other tests...")
            
            # Check for icons
            print("\nüéØ Checking for icons...")
            icons = page.locator('.lucide-dollar-sign, .lucide-file-text, .lucide-credit-card, .lucide-trending-up, .lucide-bar-chart')
            icon_count = icons.count()
            if icon_count > 0:
                print(f"‚úÖ Found {icon_count} icons")
            else:
                print("‚ùå No icons found")
            
            # Take a screenshot
            print("\nüì∏ Taking screenshot...")
            page.screenshot(path="test-results/financial_management_page_load.png")
            print("‚úÖ Screenshot saved as financial_management_page_load.png")
            
            print("\nüéâ Financial Management page load test completed!")
            return True
            
        except Exception as e:
            print(f"‚ùå Error during test: {e}")
            return False
            
        finally:
            browser.close()

if __name__ == "__main__":
    success = test_financial_management_page_load()
    if success:
        print("\n‚úÖ Financial Management page load test passed!")
    else:
        print("\n‚ùå Financial Management page load test failed.")
